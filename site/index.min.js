(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
(function (global){
//var React = require("react");
//var ReactDOM = require("react-dom");
for (var key in React.DOM) global[key] = React.DOM[key];

var Dunno = React.createClass({

    getInitialState: function(){
        return {
            id        : 0,
            ws        : null,
            page      : "wall",
            question  : "",
            questions : [],
            answereds : [], // ids of the questions I don't know
            dunnos    : [], // ids of the questions I don't know
            points    : 0
        };
    },

    componentDidMount: function(){
        var ws = new WebSocket(SERVER_URL);
        ws.onopen = function(){
            console.log("connected");
        };
        ws.onmessage = function(msg){
            var actions = JSON.parse("["+msg.data+"]");
            if (this.state.id === 0){
                ++this.state.id;
                for (var i=0, l=actions.length; i<l; ++i)
                    if (actions[i].type === "join")
                        ++this.state.id;
            };
            for (var i=0, l=actions.length; i<l; ++i){
                var action = actions[i];
                var question = this.state.questions[action.question_id];
                switch (action.type){
                    case "ask":
                    this.state.questions.push({
                        "id"          : this.state.questions.length,
                        "user_id"     : action.user_id,
                        "text"        : action.question,
                        "time"        : action.time,
                        "answer"      : "",
                        "answer_time" : 0,
                        "persons"     : 0,
                        "status"      : "routing"}); // routing, accepted, refused
                    break;

                    case "answer":
                    question.answer = action.answer;
                    question.answer_time = action.time;
                    if (action.user_id === this.state.id)
                        this.state.answereds[action.question_id] = true;
                    break;

                    case "dunno":
                    ++question.persons;
                    if (action.user_id === this.state.id)
                        this.state.dunnos[action.question_id] = true;
                    break;

                    case "accept":
                    if (question.answer !== "" 
                        && question.status === "routing" 
                        && action.user_id === question.user_id){
                        question.status = "accepted";
                        if (this.state.answereds[question.id])
                            ++this.state.points;
                    };
                    break;

                    case "refuse":
                    if (question.answer !== "" 
                        && question.status === "routing" 
                        && action.user_id === question.user_id){
                        question.status = "refused";
                        if (this.state.answereds[question.id])
                            --this.state.points;
                    };
                    break;
                }
            };
            console.log("Client id is: "+this.state.id)
            console.log("Questions: "+JSON.stringify(this.state.questions));

            this.state.act = function(action){
                return function(){
                    ws.send(JSON.stringify(action));
                };
            };

            this.forceUpdate();
        }.bind(this);
        setInterval(function(){
            this.forceUpdate();
        }.bind(this), 500);
    },

    render: function() {

        function centralize(body){
            return div({"className": "centralizer_outer"},
                div({"className": "centralizer_inner"},
                body));
        };

        var question = function(question){

            var question_title = div({
                "className": "question_title"}, [
                question.text]);

            var question_seconds = div({
                "className": "question_seconds"},
                Math.floor(((question.answer_time||Date.now())-question.time)/1000)+'"');

            var question_persons = div({
                "className": "question_persons"},
                question.persons+"ì›ƒ"); // ðŸ‘¤

            var question_head_box = div({
                "className": "question_head_box"},[
                question_seconds,
                question_persons]);

            var question_accepted = div({
                "onClick": function(){
                    this.state.act({
                        "type":"accept",
                        "user_id": this.state.id,
                        "question_id":question.id})();
                }.bind(this),
                "className":"question_acception "+(question.status==="accepted"?"accepted":"")},
                "âœ“");

            var question_refused = div({
                "onClick": function(){
                    this.state.act({
                        "type":"refuse",
                        "user_id": this.state.id,
                        "question_id":question.id})();
                }.bind(this),
                "className":"question_acception "+(question.status==="refused"?"refused":"")},
                "âœ—");

            var question_acception_box = div({
                "className": "question_acception_box"},[
                question_accepted,
                question_refused]);


            var question_head = div({
                "className": "question_head"},[
                question_head_box,
                question_acception_box]);

            var question_answer = div({
                "className": "question_answer"},[
                question.answer !== ""
                    ? question.answer
                    : "Esperando resposta..."]);

            var question_body = div({
                "className": "question_body"},[
                question_title,
                question_answer]);
                
            var question_lamp = div({
                "className": "question_lamp"},
                //"X");
                img({"src": (question.status==="routing" ? (question.answer==="" ? "img/lampada_apagada.png" : "img/lampada_acesa.gif") :
                            (question.status==="accepted" ? "img/lampada_acesa.png" :
                            "img/lampada_apagada.png")),
                    "alt": "lampada",
                    "width":"100",
                    "height":"100"
                }));
                
            return div({
                "className": "question"},[
                question_head,
                question_body,
                question_lamp
                ]);
        }.bind(this);

        var st = this.state;



        // HOME PAGE

        var logo = div({
            "onClick": function(){ st.page = "home"; }.bind(this),
            "className": st.page === "home" ? "logo" : "logo_small"},
            "Dunno");

        var question_field = div({}, input({
            "id": "question_field",
            "key": "question_field",
            "className": "question_field",
            "onKeyPress": function(e){ if (e.which === 13) ask(); },
            "onChange": function(e){
                st.question = e.target.value;
                this.forceUpdate();
            }.bind(this),
            "type": "text"}));

        var ask = function(){
            if (st.question.length === 0) return;
            this.state.act({
                "type"     : "ask",
                "question" : st.question,
                "time"     : Date.now(),
                "user_id"  : st.id})();
            st.question = "";
            st.page = "wall";
            this.forceUpdate();
            document.getElementById("question_field").value = "";
        }.bind(this);

        var ask_button = div({
            "id": "ask_button",
            "key": "ask_button",
            "onClick": ask,
            "className": "button ask_button"},
            ["Fazer pergunta"]);

        var quick_button = div({
            "id": "quick_button",
            "key": "quick_button",
            "onClick": function(){
                st.page = "answering";
                this.forceUpdate();
            }.bind(this),
            "className": "button quick_button"},
            ["Prefiro responder"]);

        var buttons_container = div({
            "key": "buttons_container",
            "className": "button_container"},
            [ask_button, quick_button]);

        var home = div({
            "className": "home"},
            [logo, question_field, buttons_container]);



        // WALLS PAGE

        var wall_top = div({
            "className": "wall_top"},
            centralize(
                div({
                    "className": "wall_top_content"}, [
                    logo,
                    question_field,
                    ask_button,
                    quick_button])));

        var my_questions = st.questions.filter(function(question){
            return question.user_id === st.id;
        }.bind(this)).reverse();

        var wall_body = centralize(my_questions.map(question));

        var wall = div({
            "className": "wall"},
            [wall_top, wall_body]);



        // ANSWERING PAGE

        var answering_points = div({
            "className": "answering_points"},
            "("+this.state.points+" ponto"+(this.state.points===1?"":"s")+"!)");

        var answering_top = div({
            "className": "answering_top"},[
            logo,
            answering_points]);

        function rand(seed){
            return (seed * 1103515245 + 12345) & 0x7fffffff;
        };

        var question_to_answer = (function(){
            var question_to_answer = null;
            var question_to_answer_rnd = 0;
            var rnd = rand(st.id);
            for (var i=0, l=st.questions.length; i<l; ++i){
                var rnd = rand(rnd);
                if (rnd > question_to_answer_rnd
                    && st.questions[i]
                    && st.questions[i].answer === ""
                    && !st.dunnos[i])
                    question_to_answer = st.questions[i],
                    question_to_answer_rnd = rnd;
            };
            return question_to_answer;
        })();

        var answering_question = question_to_answer ? question(question_to_answer) : [];

        var answer = function(){
            var input = document.getElementById("answering_input")
            this.state.act({
                "type"        : "answer",
                "time"        : Date.now(),
                "user_id"     : st.id,
                "question_id" : question_to_answer.id,
                "answer"      : input.value})();
            input.value = "";
        }.bind(this);

        var dunno = function(){
            this.state.act({
                "type"        : "dunno",
                "user_id"     : st.id,
                "question_id" : question_to_answer.id})();
        }.bind(this)

        var answering_answer = div({
            "className": "answering_button",
            "onClick": answer},
            "Responder");

        var answering_dunno = div({
            "className": "answering_button",
            "onClick": dunno},
            "Dunno")

        var answering_menu = div({
            "className": "answer_menu"}, [
            div({}, input({
                "id": "answering_input",
                "className": "answering_input",
                "onKeyDown": function(e){ if (e.which === 13) answer(); }})),
            div({}, [answering_answer, answering_dunno])]);

        var answering_body = div({
            className: "answering_body"},[
            answering_question,
            answering_menu]);

        //var answering_points = div({}, this.state.points+()" pontos!");

        var answering_done = div({
            className: "answering_done"}, [
            "Nada para responder! Esperando novas questÃµes."]);

        var answering = question_to_answer 
            ? div({}, [answering_top, centralize(answering_body)])
            : div({}, [answering_top, centralize(answering_done)]);

        return ( st.page === "home" ? home 
               : st.page === "wall" ? wall
               : answering);
    }
});

window.onload = function(){
    ReactDOM.render(
        React.createElement(Dunno, null),
        document.getElementById('test'));
};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL0FwcERhdGEvUm9hbWluZy9ucG0vbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsImluZGV4LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOztBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIvL3ZhciBSZWFjdCA9IHJlcXVpcmUoXCJyZWFjdFwiKTtcclxuLy92YXIgUmVhY3RET00gPSByZXF1aXJlKFwicmVhY3QtZG9tXCIpO1xyXG5mb3IgKHZhciBrZXkgaW4gUmVhY3QuRE9NKSBnbG9iYWxba2V5XSA9IFJlYWN0LkRPTVtrZXldO1xyXG5cclxudmFyIER1bm5vID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xyXG5cclxuICAgIGdldEluaXRpYWxTdGF0ZTogZnVuY3Rpb24oKXtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpZCAgICAgICAgOiAwLFxyXG4gICAgICAgICAgICB3cyAgICAgICAgOiBudWxsLFxyXG4gICAgICAgICAgICBwYWdlICAgICAgOiBcIndhbGxcIixcclxuICAgICAgICAgICAgcXVlc3Rpb24gIDogXCJcIixcclxuICAgICAgICAgICAgcXVlc3Rpb25zIDogW10sXHJcbiAgICAgICAgICAgIGFuc3dlcmVkcyA6IFtdLCAvLyBpZHMgb2YgdGhlIHF1ZXN0aW9ucyBJIGRvbid0IGtub3dcclxuICAgICAgICAgICAgZHVubm9zICAgIDogW10sIC8vIGlkcyBvZiB0aGUgcXVlc3Rpb25zIEkgZG9uJ3Qga25vd1xyXG4gICAgICAgICAgICBwb2ludHMgICAgOiAwXHJcbiAgICAgICAgfTtcclxuICAgIH0sXHJcblxyXG4gICAgY29tcG9uZW50RGlkTW91bnQ6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgdmFyIHdzID0gbmV3IFdlYlNvY2tldChTRVJWRVJfVVJMKTtcclxuICAgICAgICB3cy5vbm9wZW4gPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImNvbm5lY3RlZFwiKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHdzLm9ubWVzc2FnZSA9IGZ1bmN0aW9uKG1zZyl7XHJcbiAgICAgICAgICAgIHZhciBhY3Rpb25zID0gSlNPTi5wYXJzZShcIltcIittc2cuZGF0YStcIl1cIik7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlLmlkID09PSAwKXtcclxuICAgICAgICAgICAgICAgICsrdGhpcy5zdGF0ZS5pZDtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGk9MCwgbD1hY3Rpb25zLmxlbmd0aDsgaTxsOyArK2kpXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGlvbnNbaV0udHlwZSA9PT0gXCJqb2luXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICsrdGhpcy5zdGF0ZS5pZDtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaT0wLCBsPWFjdGlvbnMubGVuZ3RoOyBpPGw7ICsraSl7XHJcbiAgICAgICAgICAgICAgICB2YXIgYWN0aW9uID0gYWN0aW9uc1tpXTtcclxuICAgICAgICAgICAgICAgIHZhciBxdWVzdGlvbiA9IHRoaXMuc3RhdGUucXVlc3Rpb25zW2FjdGlvbi5xdWVzdGlvbl9pZF07XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGFjdGlvbi50eXBlKXtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiYXNrXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0ZS5xdWVzdGlvbnMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiaWRcIiAgICAgICAgICA6IHRoaXMuc3RhdGUucXVlc3Rpb25zLmxlbmd0aCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ1c2VyX2lkXCIgICAgIDogYWN0aW9uLnVzZXJfaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidGV4dFwiICAgICAgICA6IGFjdGlvbi5xdWVzdGlvbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ0aW1lXCIgICAgICAgIDogYWN0aW9uLnRpbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiYW5zd2VyXCIgICAgICA6IFwiXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiYW5zd2VyX3RpbWVcIiA6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwicGVyc29uc1wiICAgICA6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhdHVzXCIgICAgICA6IFwicm91dGluZ1wifSk7IC8vIHJvdXRpbmcsIGFjY2VwdGVkLCByZWZ1c2VkXHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJhbnN3ZXJcIjpcclxuICAgICAgICAgICAgICAgICAgICBxdWVzdGlvbi5hbnN3ZXIgPSBhY3Rpb24uYW5zd2VyO1xyXG4gICAgICAgICAgICAgICAgICAgIHF1ZXN0aW9uLmFuc3dlcl90aW1lID0gYWN0aW9uLnRpbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGlvbi51c2VyX2lkID09PSB0aGlzLnN0YXRlLmlkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRlLmFuc3dlcmVkc1thY3Rpb24ucXVlc3Rpb25faWRdID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcImR1bm5vXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgKytxdWVzdGlvbi5wZXJzb25zO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhY3Rpb24udXNlcl9pZCA9PT0gdGhpcy5zdGF0ZS5pZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0ZS5kdW5ub3NbYWN0aW9uLnF1ZXN0aW9uX2lkXSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJhY2NlcHRcIjpcclxuICAgICAgICAgICAgICAgICAgICBpZiAocXVlc3Rpb24uYW5zd2VyICE9PSBcIlwiIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAmJiBxdWVzdGlvbi5zdGF0dXMgPT09IFwicm91dGluZ1wiIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAmJiBhY3Rpb24udXNlcl9pZCA9PT0gcXVlc3Rpb24udXNlcl9pZCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXN0aW9uLnN0YXR1cyA9IFwiYWNjZXB0ZWRcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUuYW5zd2VyZWRzW3F1ZXN0aW9uLmlkXSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICsrdGhpcy5zdGF0ZS5wb2ludHM7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcInJlZnVzZVwiOlxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChxdWVzdGlvbi5hbnN3ZXIgIT09IFwiXCIgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICYmIHF1ZXN0aW9uLnN0YXR1cyA9PT0gXCJyb3V0aW5nXCIgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICYmIGFjdGlvbi51c2VyX2lkID09PSBxdWVzdGlvbi51c2VyX2lkKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcXVlc3Rpb24uc3RhdHVzID0gXCJyZWZ1c2VkXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlLmFuc3dlcmVkc1txdWVzdGlvbi5pZF0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtLXRoaXMuc3RhdGUucG9pbnRzO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiQ2xpZW50IGlkIGlzOiBcIit0aGlzLnN0YXRlLmlkKVxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlF1ZXN0aW9uczogXCIrSlNPTi5zdHJpbmdpZnkodGhpcy5zdGF0ZS5xdWVzdGlvbnMpKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuc3RhdGUuYWN0ID0gZnVuY3Rpb24oYWN0aW9uKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgIHdzLnNlbmQoSlNPTi5zdHJpbmdpZnkoYWN0aW9uKSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgdGhpcy5mb3JjZVVwZGF0ZSgpO1xyXG4gICAgICAgIH0uYmluZCh0aGlzKTtcclxuICAgICAgICBzZXRJbnRlcnZhbChmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICB0aGlzLmZvcmNlVXBkYXRlKCk7XHJcbiAgICAgICAgfS5iaW5kKHRoaXMpLCA1MDApO1xyXG4gICAgfSxcclxuXHJcbiAgICByZW5kZXI6IGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBjZW50cmFsaXplKGJvZHkpe1xyXG4gICAgICAgICAgICByZXR1cm4gZGl2KHtcImNsYXNzTmFtZVwiOiBcImNlbnRyYWxpemVyX291dGVyXCJ9LFxyXG4gICAgICAgICAgICAgICAgZGl2KHtcImNsYXNzTmFtZVwiOiBcImNlbnRyYWxpemVyX2lubmVyXCJ9LFxyXG4gICAgICAgICAgICAgICAgYm9keSkpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBxdWVzdGlvbiA9IGZ1bmN0aW9uKHF1ZXN0aW9uKXtcclxuXHJcbiAgICAgICAgICAgIHZhciBxdWVzdGlvbl90aXRsZSA9IGRpdih7XHJcbiAgICAgICAgICAgICAgICBcImNsYXNzTmFtZVwiOiBcInF1ZXN0aW9uX3RpdGxlXCJ9LCBbXHJcbiAgICAgICAgICAgICAgICBxdWVzdGlvbi50ZXh0XSk7XHJcblxyXG4gICAgICAgICAgICB2YXIgcXVlc3Rpb25fc2Vjb25kcyA9IGRpdih7XHJcbiAgICAgICAgICAgICAgICBcImNsYXNzTmFtZVwiOiBcInF1ZXN0aW9uX3NlY29uZHNcIn0sXHJcbiAgICAgICAgICAgICAgICBNYXRoLmZsb29yKCgocXVlc3Rpb24uYW5zd2VyX3RpbWV8fERhdGUubm93KCkpLXF1ZXN0aW9uLnRpbWUpLzEwMDApKydcIicpO1xyXG5cclxuICAgICAgICAgICAgdmFyIHF1ZXN0aW9uX3BlcnNvbnMgPSBkaXYoe1xyXG4gICAgICAgICAgICAgICAgXCJjbGFzc05hbWVcIjogXCJxdWVzdGlvbl9wZXJzb25zXCJ9LFxyXG4gICAgICAgICAgICAgICAgcXVlc3Rpb24ucGVyc29ucytcIuybg1wiKTsgLy8g8J+RpFxyXG5cclxuICAgICAgICAgICAgdmFyIHF1ZXN0aW9uX2hlYWRfYm94ID0gZGl2KHtcclxuICAgICAgICAgICAgICAgIFwiY2xhc3NOYW1lXCI6IFwicXVlc3Rpb25faGVhZF9ib3hcIn0sW1xyXG4gICAgICAgICAgICAgICAgcXVlc3Rpb25fc2Vjb25kcyxcclxuICAgICAgICAgICAgICAgIHF1ZXN0aW9uX3BlcnNvbnNdKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBxdWVzdGlvbl9hY2NlcHRlZCA9IGRpdih7XHJcbiAgICAgICAgICAgICAgICBcIm9uQ2xpY2tcIjogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRlLmFjdCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidHlwZVwiOlwiYWNjZXB0XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidXNlcl9pZFwiOiB0aGlzLnN0YXRlLmlkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInF1ZXN0aW9uX2lkXCI6cXVlc3Rpb24uaWR9KSgpO1xyXG4gICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpLFxyXG4gICAgICAgICAgICAgICAgXCJjbGFzc05hbWVcIjpcInF1ZXN0aW9uX2FjY2VwdGlvbiBcIisocXVlc3Rpb24uc3RhdHVzPT09XCJhY2NlcHRlZFwiP1wiYWNjZXB0ZWRcIjpcIlwiKX0sXHJcbiAgICAgICAgICAgICAgICBcIuKck1wiKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBxdWVzdGlvbl9yZWZ1c2VkID0gZGl2KHtcclxuICAgICAgICAgICAgICAgIFwib25DbGlja1wiOiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdGUuYWN0KHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ0eXBlXCI6XCJyZWZ1c2VcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ1c2VyX2lkXCI6IHRoaXMuc3RhdGUuaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwicXVlc3Rpb25faWRcIjpxdWVzdGlvbi5pZH0pKCk7XHJcbiAgICAgICAgICAgICAgICB9LmJpbmQodGhpcyksXHJcbiAgICAgICAgICAgICAgICBcImNsYXNzTmFtZVwiOlwicXVlc3Rpb25fYWNjZXB0aW9uIFwiKyhxdWVzdGlvbi5zdGF0dXM9PT1cInJlZnVzZWRcIj9cInJlZnVzZWRcIjpcIlwiKX0sXHJcbiAgICAgICAgICAgICAgICBcIuKcl1wiKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBxdWVzdGlvbl9hY2NlcHRpb25fYm94ID0gZGl2KHtcclxuICAgICAgICAgICAgICAgIFwiY2xhc3NOYW1lXCI6IFwicXVlc3Rpb25fYWNjZXB0aW9uX2JveFwifSxbXHJcbiAgICAgICAgICAgICAgICBxdWVzdGlvbl9hY2NlcHRlZCxcclxuICAgICAgICAgICAgICAgIHF1ZXN0aW9uX3JlZnVzZWRdKTtcclxuXHJcblxyXG4gICAgICAgICAgICB2YXIgcXVlc3Rpb25faGVhZCA9IGRpdih7XHJcbiAgICAgICAgICAgICAgICBcImNsYXNzTmFtZVwiOiBcInF1ZXN0aW9uX2hlYWRcIn0sW1xyXG4gICAgICAgICAgICAgICAgcXVlc3Rpb25faGVhZF9ib3gsXHJcbiAgICAgICAgICAgICAgICBxdWVzdGlvbl9hY2NlcHRpb25fYm94XSk7XHJcblxyXG4gICAgICAgICAgICB2YXIgcXVlc3Rpb25fYW5zd2VyID0gZGl2KHtcclxuICAgICAgICAgICAgICAgIFwiY2xhc3NOYW1lXCI6IFwicXVlc3Rpb25fYW5zd2VyXCJ9LFtcclxuICAgICAgICAgICAgICAgIHF1ZXN0aW9uLmFuc3dlciAhPT0gXCJcIlxyXG4gICAgICAgICAgICAgICAgICAgID8gcXVlc3Rpb24uYW5zd2VyXHJcbiAgICAgICAgICAgICAgICAgICAgOiBcIkVzcGVyYW5kbyByZXNwb3N0YS4uLlwiXSk7XHJcblxyXG4gICAgICAgICAgICB2YXIgcXVlc3Rpb25fYm9keSA9IGRpdih7XHJcbiAgICAgICAgICAgICAgICBcImNsYXNzTmFtZVwiOiBcInF1ZXN0aW9uX2JvZHlcIn0sW1xyXG4gICAgICAgICAgICAgICAgcXVlc3Rpb25fdGl0bGUsXHJcbiAgICAgICAgICAgICAgICBxdWVzdGlvbl9hbnN3ZXJdKTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB2YXIgcXVlc3Rpb25fbGFtcCA9IGRpdih7XHJcbiAgICAgICAgICAgICAgICBcImNsYXNzTmFtZVwiOiBcInF1ZXN0aW9uX2xhbXBcIn0sXHJcbiAgICAgICAgICAgICAgICAvL1wiWFwiKTtcclxuICAgICAgICAgICAgICAgIGltZyh7XCJzcmNcIjogKHF1ZXN0aW9uLnN0YXR1cz09PVwicm91dGluZ1wiID8gKHF1ZXN0aW9uLmFuc3dlcj09PVwiXCIgPyBcImltZy9sYW1wYWRhX2FwYWdhZGEucG5nXCIgOiBcImltZy9sYW1wYWRhX2FjZXNhLmdpZlwiKSA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAocXVlc3Rpb24uc3RhdHVzPT09XCJhY2NlcHRlZFwiID8gXCJpbWcvbGFtcGFkYV9hY2VzYS5wbmdcIiA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImltZy9sYW1wYWRhX2FwYWdhZGEucG5nXCIpKSxcclxuICAgICAgICAgICAgICAgICAgICBcImFsdFwiOiBcImxhbXBhZGFcIixcclxuICAgICAgICAgICAgICAgICAgICBcIndpZHRoXCI6XCIxMDBcIixcclxuICAgICAgICAgICAgICAgICAgICBcImhlaWdodFwiOlwiMTAwXCJcclxuICAgICAgICAgICAgICAgIH0pKTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICByZXR1cm4gZGl2KHtcclxuICAgICAgICAgICAgICAgIFwiY2xhc3NOYW1lXCI6IFwicXVlc3Rpb25cIn0sW1xyXG4gICAgICAgICAgICAgICAgcXVlc3Rpb25faGVhZCxcclxuICAgICAgICAgICAgICAgIHF1ZXN0aW9uX2JvZHksXHJcbiAgICAgICAgICAgICAgICBxdWVzdGlvbl9sYW1wXHJcbiAgICAgICAgICAgICAgICBdKTtcclxuICAgICAgICB9LmJpbmQodGhpcyk7XHJcblxyXG4gICAgICAgIHZhciBzdCA9IHRoaXMuc3RhdGU7XHJcblxyXG5cclxuXHJcbiAgICAgICAgLy8gSE9NRSBQQUdFXHJcblxyXG4gICAgICAgIHZhciBsb2dvID0gZGl2KHtcclxuICAgICAgICAgICAgXCJvbkNsaWNrXCI6IGZ1bmN0aW9uKCl7IHN0LnBhZ2UgPSBcImhvbWVcIjsgfS5iaW5kKHRoaXMpLFxyXG4gICAgICAgICAgICBcImNsYXNzTmFtZVwiOiBzdC5wYWdlID09PSBcImhvbWVcIiA/IFwibG9nb1wiIDogXCJsb2dvX3NtYWxsXCJ9LFxyXG4gICAgICAgICAgICBcIkR1bm5vXCIpO1xyXG5cclxuICAgICAgICB2YXIgcXVlc3Rpb25fZmllbGQgPSBkaXYoe30sIGlucHV0KHtcclxuICAgICAgICAgICAgXCJpZFwiOiBcInF1ZXN0aW9uX2ZpZWxkXCIsXHJcbiAgICAgICAgICAgIFwia2V5XCI6IFwicXVlc3Rpb25fZmllbGRcIixcclxuICAgICAgICAgICAgXCJjbGFzc05hbWVcIjogXCJxdWVzdGlvbl9maWVsZFwiLFxyXG4gICAgICAgICAgICBcIm9uS2V5UHJlc3NcIjogZnVuY3Rpb24oZSl7IGlmIChlLndoaWNoID09PSAxMykgYXNrKCk7IH0sXHJcbiAgICAgICAgICAgIFwib25DaGFuZ2VcIjogZnVuY3Rpb24oZSl7XHJcbiAgICAgICAgICAgICAgICBzdC5xdWVzdGlvbiA9IGUudGFyZ2V0LnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5mb3JjZVVwZGF0ZSgpO1xyXG4gICAgICAgICAgICB9LmJpbmQodGhpcyksXHJcbiAgICAgICAgICAgIFwidHlwZVwiOiBcInRleHRcIn0pKTtcclxuXHJcbiAgICAgICAgdmFyIGFzayA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIGlmIChzdC5xdWVzdGlvbi5sZW5ndGggPT09IDApIHJldHVybjtcclxuICAgICAgICAgICAgdGhpcy5zdGF0ZS5hY3Qoe1xyXG4gICAgICAgICAgICAgICAgXCJ0eXBlXCIgICAgIDogXCJhc2tcIixcclxuICAgICAgICAgICAgICAgIFwicXVlc3Rpb25cIiA6IHN0LnF1ZXN0aW9uLFxyXG4gICAgICAgICAgICAgICAgXCJ0aW1lXCIgICAgIDogRGF0ZS5ub3coKSxcclxuICAgICAgICAgICAgICAgIFwidXNlcl9pZFwiICA6IHN0LmlkfSkoKTtcclxuICAgICAgICAgICAgc3QucXVlc3Rpb24gPSBcIlwiO1xyXG4gICAgICAgICAgICBzdC5wYWdlID0gXCJ3YWxsXCI7XHJcbiAgICAgICAgICAgIHRoaXMuZm9yY2VVcGRhdGUoKTtcclxuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJxdWVzdGlvbl9maWVsZFwiKS52YWx1ZSA9IFwiXCI7XHJcbiAgICAgICAgfS5iaW5kKHRoaXMpO1xyXG5cclxuICAgICAgICB2YXIgYXNrX2J1dHRvbiA9IGRpdih7XHJcbiAgICAgICAgICAgIFwiaWRcIjogXCJhc2tfYnV0dG9uXCIsXHJcbiAgICAgICAgICAgIFwia2V5XCI6IFwiYXNrX2J1dHRvblwiLFxyXG4gICAgICAgICAgICBcIm9uQ2xpY2tcIjogYXNrLFxyXG4gICAgICAgICAgICBcImNsYXNzTmFtZVwiOiBcImJ1dHRvbiBhc2tfYnV0dG9uXCJ9LFxyXG4gICAgICAgICAgICBbXCJGYXplciBwZXJndW50YVwiXSk7XHJcblxyXG4gICAgICAgIHZhciBxdWlja19idXR0b24gPSBkaXYoe1xyXG4gICAgICAgICAgICBcImlkXCI6IFwicXVpY2tfYnV0dG9uXCIsXHJcbiAgICAgICAgICAgIFwia2V5XCI6IFwicXVpY2tfYnV0dG9uXCIsXHJcbiAgICAgICAgICAgIFwib25DbGlja1wiOiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgc3QucGFnZSA9IFwiYW5zd2VyaW5nXCI7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZvcmNlVXBkYXRlKCk7XHJcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSxcclxuICAgICAgICAgICAgXCJjbGFzc05hbWVcIjogXCJidXR0b24gcXVpY2tfYnV0dG9uXCJ9LFxyXG4gICAgICAgICAgICBbXCJQcmVmaXJvIHJlc3BvbmRlclwiXSk7XHJcblxyXG4gICAgICAgIHZhciBidXR0b25zX2NvbnRhaW5lciA9IGRpdih7XHJcbiAgICAgICAgICAgIFwia2V5XCI6IFwiYnV0dG9uc19jb250YWluZXJcIixcclxuICAgICAgICAgICAgXCJjbGFzc05hbWVcIjogXCJidXR0b25fY29udGFpbmVyXCJ9LFxyXG4gICAgICAgICAgICBbYXNrX2J1dHRvbiwgcXVpY2tfYnV0dG9uXSk7XHJcblxyXG4gICAgICAgIHZhciBob21lID0gZGl2KHtcclxuICAgICAgICAgICAgXCJjbGFzc05hbWVcIjogXCJob21lXCJ9LFxyXG4gICAgICAgICAgICBbbG9nbywgcXVlc3Rpb25fZmllbGQsIGJ1dHRvbnNfY29udGFpbmVyXSk7XHJcblxyXG5cclxuXHJcbiAgICAgICAgLy8gV0FMTFMgUEFHRVxyXG5cclxuICAgICAgICB2YXIgd2FsbF90b3AgPSBkaXYoe1xyXG4gICAgICAgICAgICBcImNsYXNzTmFtZVwiOiBcIndhbGxfdG9wXCJ9LFxyXG4gICAgICAgICAgICBjZW50cmFsaXplKFxyXG4gICAgICAgICAgICAgICAgZGl2KHtcclxuICAgICAgICAgICAgICAgICAgICBcImNsYXNzTmFtZVwiOiBcIndhbGxfdG9wX2NvbnRlbnRcIn0sIFtcclxuICAgICAgICAgICAgICAgICAgICBsb2dvLFxyXG4gICAgICAgICAgICAgICAgICAgIHF1ZXN0aW9uX2ZpZWxkLFxyXG4gICAgICAgICAgICAgICAgICAgIGFza19idXR0b24sXHJcbiAgICAgICAgICAgICAgICAgICAgcXVpY2tfYnV0dG9uXSkpKTtcclxuXHJcbiAgICAgICAgdmFyIG15X3F1ZXN0aW9ucyA9IHN0LnF1ZXN0aW9ucy5maWx0ZXIoZnVuY3Rpb24ocXVlc3Rpb24pe1xyXG4gICAgICAgICAgICByZXR1cm4gcXVlc3Rpb24udXNlcl9pZCA9PT0gc3QuaWQ7XHJcbiAgICAgICAgfS5iaW5kKHRoaXMpKS5yZXZlcnNlKCk7XHJcblxyXG4gICAgICAgIHZhciB3YWxsX2JvZHkgPSBjZW50cmFsaXplKG15X3F1ZXN0aW9ucy5tYXAocXVlc3Rpb24pKTtcclxuXHJcbiAgICAgICAgdmFyIHdhbGwgPSBkaXYoe1xyXG4gICAgICAgICAgICBcImNsYXNzTmFtZVwiOiBcIndhbGxcIn0sXHJcbiAgICAgICAgICAgIFt3YWxsX3RvcCwgd2FsbF9ib2R5XSk7XHJcblxyXG5cclxuXHJcbiAgICAgICAgLy8gQU5TV0VSSU5HIFBBR0VcclxuXHJcbiAgICAgICAgdmFyIGFuc3dlcmluZ19wb2ludHMgPSBkaXYoe1xyXG4gICAgICAgICAgICBcImNsYXNzTmFtZVwiOiBcImFuc3dlcmluZ19wb2ludHNcIn0sXHJcbiAgICAgICAgICAgIFwiKFwiK3RoaXMuc3RhdGUucG9pbnRzK1wiIHBvbnRvXCIrKHRoaXMuc3RhdGUucG9pbnRzPT09MT9cIlwiOlwic1wiKStcIiEpXCIpO1xyXG5cclxuICAgICAgICB2YXIgYW5zd2VyaW5nX3RvcCA9IGRpdih7XHJcbiAgICAgICAgICAgIFwiY2xhc3NOYW1lXCI6IFwiYW5zd2VyaW5nX3RvcFwifSxbXHJcbiAgICAgICAgICAgIGxvZ28sXHJcbiAgICAgICAgICAgIGFuc3dlcmluZ19wb2ludHNdKTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmFuZChzZWVkKXtcclxuICAgICAgICAgICAgcmV0dXJuIChzZWVkICogMTEwMzUxNTI0NSArIDEyMzQ1KSAmIDB4N2ZmZmZmZmY7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHF1ZXN0aW9uX3RvX2Fuc3dlciA9IChmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICB2YXIgcXVlc3Rpb25fdG9fYW5zd2VyID0gbnVsbDtcclxuICAgICAgICAgICAgdmFyIHF1ZXN0aW9uX3RvX2Fuc3dlcl9ybmQgPSAwO1xyXG4gICAgICAgICAgICB2YXIgcm5kID0gcmFuZChzdC5pZCk7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGk9MCwgbD1zdC5xdWVzdGlvbnMubGVuZ3RoOyBpPGw7ICsraSl7XHJcbiAgICAgICAgICAgICAgICB2YXIgcm5kID0gcmFuZChybmQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJuZCA+IHF1ZXN0aW9uX3RvX2Fuc3dlcl9ybmRcclxuICAgICAgICAgICAgICAgICAgICAmJiBzdC5xdWVzdGlvbnNbaV1cclxuICAgICAgICAgICAgICAgICAgICAmJiBzdC5xdWVzdGlvbnNbaV0uYW5zd2VyID09PSBcIlwiXHJcbiAgICAgICAgICAgICAgICAgICAgJiYgIXN0LmR1bm5vc1tpXSlcclxuICAgICAgICAgICAgICAgICAgICBxdWVzdGlvbl90b19hbnN3ZXIgPSBzdC5xdWVzdGlvbnNbaV0sXHJcbiAgICAgICAgICAgICAgICAgICAgcXVlc3Rpb25fdG9fYW5zd2VyX3JuZCA9IHJuZDtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgcmV0dXJuIHF1ZXN0aW9uX3RvX2Fuc3dlcjtcclxuICAgICAgICB9KSgpO1xyXG5cclxuICAgICAgICB2YXIgYW5zd2VyaW5nX3F1ZXN0aW9uID0gcXVlc3Rpb25fdG9fYW5zd2VyID8gcXVlc3Rpb24ocXVlc3Rpb25fdG9fYW5zd2VyKSA6IFtdO1xyXG5cclxuICAgICAgICB2YXIgYW5zd2VyID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgdmFyIGlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJhbnN3ZXJpbmdfaW5wdXRcIilcclxuICAgICAgICAgICAgdGhpcy5zdGF0ZS5hY3Qoe1xyXG4gICAgICAgICAgICAgICAgXCJ0eXBlXCIgICAgICAgIDogXCJhbnN3ZXJcIixcclxuICAgICAgICAgICAgICAgIFwidGltZVwiICAgICAgICA6IERhdGUubm93KCksXHJcbiAgICAgICAgICAgICAgICBcInVzZXJfaWRcIiAgICAgOiBzdC5pZCxcclxuICAgICAgICAgICAgICAgIFwicXVlc3Rpb25faWRcIiA6IHF1ZXN0aW9uX3RvX2Fuc3dlci5pZCxcclxuICAgICAgICAgICAgICAgIFwiYW5zd2VyXCIgICAgICA6IGlucHV0LnZhbHVlfSkoKTtcclxuICAgICAgICAgICAgaW5wdXQudmFsdWUgPSBcIlwiO1xyXG4gICAgICAgIH0uYmluZCh0aGlzKTtcclxuXHJcbiAgICAgICAgdmFyIGR1bm5vID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgdGhpcy5zdGF0ZS5hY3Qoe1xyXG4gICAgICAgICAgICAgICAgXCJ0eXBlXCIgICAgICAgIDogXCJkdW5ub1wiLFxyXG4gICAgICAgICAgICAgICAgXCJ1c2VyX2lkXCIgICAgIDogc3QuaWQsXHJcbiAgICAgICAgICAgICAgICBcInF1ZXN0aW9uX2lkXCIgOiBxdWVzdGlvbl90b19hbnN3ZXIuaWR9KSgpO1xyXG4gICAgICAgIH0uYmluZCh0aGlzKVxyXG5cclxuICAgICAgICB2YXIgYW5zd2VyaW5nX2Fuc3dlciA9IGRpdih7XHJcbiAgICAgICAgICAgIFwiY2xhc3NOYW1lXCI6IFwiYW5zd2VyaW5nX2J1dHRvblwiLFxyXG4gICAgICAgICAgICBcIm9uQ2xpY2tcIjogYW5zd2VyfSxcclxuICAgICAgICAgICAgXCJSZXNwb25kZXJcIik7XHJcblxyXG4gICAgICAgIHZhciBhbnN3ZXJpbmdfZHVubm8gPSBkaXYoe1xyXG4gICAgICAgICAgICBcImNsYXNzTmFtZVwiOiBcImFuc3dlcmluZ19idXR0b25cIixcclxuICAgICAgICAgICAgXCJvbkNsaWNrXCI6IGR1bm5vfSxcclxuICAgICAgICAgICAgXCJEdW5ub1wiKVxyXG5cclxuICAgICAgICB2YXIgYW5zd2VyaW5nX21lbnUgPSBkaXYoe1xyXG4gICAgICAgICAgICBcImNsYXNzTmFtZVwiOiBcImFuc3dlcl9tZW51XCJ9LCBbXHJcbiAgICAgICAgICAgIGRpdih7fSwgaW5wdXQoe1xyXG4gICAgICAgICAgICAgICAgXCJpZFwiOiBcImFuc3dlcmluZ19pbnB1dFwiLFxyXG4gICAgICAgICAgICAgICAgXCJjbGFzc05hbWVcIjogXCJhbnN3ZXJpbmdfaW5wdXRcIixcclxuICAgICAgICAgICAgICAgIFwib25LZXlEb3duXCI6IGZ1bmN0aW9uKGUpeyBpZiAoZS53aGljaCA9PT0gMTMpIGFuc3dlcigpOyB9fSkpLFxyXG4gICAgICAgICAgICBkaXYoe30sIFthbnN3ZXJpbmdfYW5zd2VyLCBhbnN3ZXJpbmdfZHVubm9dKV0pO1xyXG5cclxuICAgICAgICB2YXIgYW5zd2VyaW5nX2JvZHkgPSBkaXYoe1xyXG4gICAgICAgICAgICBjbGFzc05hbWU6IFwiYW5zd2VyaW5nX2JvZHlcIn0sW1xyXG4gICAgICAgICAgICBhbnN3ZXJpbmdfcXVlc3Rpb24sXHJcbiAgICAgICAgICAgIGFuc3dlcmluZ19tZW51XSk7XHJcblxyXG4gICAgICAgIC8vdmFyIGFuc3dlcmluZ19wb2ludHMgPSBkaXYoe30sIHRoaXMuc3RhdGUucG9pbnRzKygpXCIgcG9udG9zIVwiKTtcclxuXHJcbiAgICAgICAgdmFyIGFuc3dlcmluZ19kb25lID0gZGl2KHtcclxuICAgICAgICAgICAgY2xhc3NOYW1lOiBcImFuc3dlcmluZ19kb25lXCJ9LCBbXHJcbiAgICAgICAgICAgIFwiTmFkYSBwYXJhIHJlc3BvbmRlciEgRXNwZXJhbmRvIG5vdmFzIHF1ZXN0w7Vlcy5cIl0pO1xyXG5cclxuICAgICAgICB2YXIgYW5zd2VyaW5nID0gcXVlc3Rpb25fdG9fYW5zd2VyIFxyXG4gICAgICAgICAgICA/IGRpdih7fSwgW2Fuc3dlcmluZ190b3AsIGNlbnRyYWxpemUoYW5zd2VyaW5nX2JvZHkpXSlcclxuICAgICAgICAgICAgOiBkaXYoe30sIFthbnN3ZXJpbmdfdG9wLCBjZW50cmFsaXplKGFuc3dlcmluZ19kb25lKV0pO1xyXG5cclxuICAgICAgICByZXR1cm4gKCBzdC5wYWdlID09PSBcImhvbWVcIiA/IGhvbWUgXHJcbiAgICAgICAgICAgICAgIDogc3QucGFnZSA9PT0gXCJ3YWxsXCIgPyB3YWxsXHJcbiAgICAgICAgICAgICAgIDogYW5zd2VyaW5nKTtcclxuICAgIH1cclxufSk7XHJcblxyXG53aW5kb3cub25sb2FkID0gZnVuY3Rpb24oKXtcclxuICAgIFJlYWN0RE9NLnJlbmRlcihcclxuICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KER1bm5vLCBudWxsKSxcclxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGVzdCcpKTtcclxufTtcclxuIl19
