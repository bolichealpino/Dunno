(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
(function (global){
//var React = require("react");
//var ReactDOM = require("react-dom");
for (var key in React.DOM) global[key] = React.DOM[key];

var Dunno = React.createClass({

    getInitialState: function(){
        return {
            id        : 0,
            ws        : null,
            page      : "wall",
            question  : "",
            questions : [],
            answereds : [], // ids of the questions I don't know
            dunnos    : [], // ids of the questions I don't know
            points    : 0
        };
    },

    componentDidMount: function(){
        var ws = new WebSocket(SERVER_URL);
        ws.onopen = function(){
            console.log("connected");
        };
        ws.onmessage = function(msg){
            var actions = JSON.parse("["+msg.data+"]");
            if (this.state.id === 0){
                ++this.state.id;
                for (var i=0, l=actions.length; i<l; ++i)
                    if (actions[i].type === "join")
                        ++this.state.id;
            };
            for (var i=0, l=actions.length; i<l; ++i){
                var action = actions[i];
                var question = this.state.questions[action.question_id];
                switch (action.type){
                    case "ask":
                    this.state.questions.push({
                        "id"          : this.state.questions.length,
                        "user_id"     : action.user_id,
                        "text"        : action.question,
                        "time"        : action.time,
                        "answer"      : "",
                        "answer_time" : 0,
                        "persons"     : 0,
                        "status"      : "routing"}); // routing, accepted, refused
                    break;

                    case "answer":
                    question.answer = action.answer;
                    question.answer_time = action.time;
                    if (action.user_id === this.state.id)
                        this.state.answereds[action.question_id] = true;
                    break;

                    case "dunno":
                    ++question.persons;
                    if (action.user_id === this.state.id)
                        this.state.dunnos[action.question_id] = true;
                    break;

                    case "accept":
                    if (question.answer !== "" 
                        && question.status === "routing" 
                        && action.user_id === question.user_id){
                        question.status = "accepted";
                        if (this.state.answereds[question.id])
                            ++this.state.points;
                    };
                    break;

                    case "refuse":
                    if (question.answer !== "" 
                        && question.status === "routing" 
                        && action.user_id === question.user_id){
                        question.status = "refused";
                        if (this.state.answereds[question.id])
                            --this.state.points;
                    };
                    break;
                }
            };
            console.log("Client id is: "+this.state.id)
            console.log("Questions: "+JSON.stringify(this.state.questions));

            this.state.act = function(action){
                return function(){
                    ws.send(JSON.stringify(action));
                };
            };

            this.forceUpdate();
        }.bind(this);
        setInterval(function(){
            this.forceUpdate();
        }.bind(this), 500);
    },

    render: function() {

        function centralize(body){
            return div({"className": "centralizer_outer"},
                div({"className": "centralizer_inner"},
                body));
        };

        var question = function(question){

            var question_title = div({
                "className": "question_title"}, [
                question.text]);

            var question_seconds = div({
                "className": "question_seconds"},
                Math.floor(((question.answer_time||Date.now())-question.time)/1000)+'"');

            var question_persons = div({
                "className": "question_persons"},
                question.persons+"ÏõÉ"); // üë§

            var question_head_box = div({
                "className": "question_head_box"},[
                question_seconds,
                question_persons]);

            var question_accepted = div({
                "onClick": function(){
                    this.state.act({
                        "type":"accept",
                        "user_id": this.state.id,
                        "question_id":question.id})();
                }.bind(this),
                "className":"question_acception "+(question.status==="accepted"?"accepted":"")},
                "‚úì");

            var question_refused = div({
                "onClick": function(){
                    this.state.act({
                        "type":"refuse",
                        "user_id": this.state.id,
                        "question_id":question.id})();
                }.bind(this),
                "className":"question_acception "+(question.status==="refused"?"refused":"")},
                "‚úó");

            var question_acception_box = div({
                "className": "question_acception_box"},[
                question_accepted,
                question_refused]);


            var question_head = div({
                "className": "question_head"},[
                question_head_box,
                question_acception_box]);

            var question_answer = div({
                "className": "question_answer"},[
                question.answer !== ""
                    ? question.answer
                    : "Esperando resposta..."]);

            var question_body = div({
                "className": "question_body"},[
                question_title,
                question_answer]);
                
            var question_lamp = div({
                "className": "question_lamp"},
                //"X");
                img({"src": (question.status==="routing" ? (question.answer==="" ? "img/lampada_apagada.png" : "img/lampada_acesa.gif") :
                            (question.status==="accepted" ? "img/lampada_acesa.png" :
                            "img/lampada_apagada.png")),
                    "alt": "lampada",
                    "width":"100",
                    "height":"100"
                }));
                
            return div({
                "className": "question"},[
                question_head,
                question_body,
                question_lamp
                ]);
        }.bind(this);

        var st = this.state;



        // HOME PAGE

        var logo = div({
            "onClick": function(){ st.page = "home"; }.bind(this),
            "className": st.page === "home" ? "logo" : "logo_small"},
            "dunno");

        var question_field = div({"className": "question_field_box"}, input({
            "id": "question_field",
            "key": "question_field",
            "className": "question_field",
            "placeholder": "<inserir slogan aqui>",
            "onKeyPress": function(e){ if (e.which === 13) ask(); },
            "onChange": function(e){
                st.question = e.target.value;
                this.forceUpdate();
            }.bind(this),
            "type": "text"}));

        var ask = function(){
            if (st.question.length === 0) return;
            this.state.act({
                "type"     : "ask",
                "question" : st.question,
                "time"     : Date.now(),
                "user_id"  : st.id})();
            st.question = "";
            st.page = "wall";
            this.forceUpdate();
            document.getElementById("question_field").value = "";
        }.bind(this);

        var ask_button = div({
            "id": "ask_button",
            "key": "ask_button",
            "onClick": ask,
            "className": "button ask_button"},
            ["Fazer pergunta"]);

        var quick_button = div({
            "id": "quick_button",
            "key": "quick_button",
            "onClick": function(){
                st.page = "answering";
                this.forceUpdate();
            }.bind(this),
            "className": "button quick_button"},
            ["Prefiro responder"]);

        var buttons_container = div({
            "key": "buttons_container",
            "className": "button_container"},
            [ask_button, quick_button]);

        var home = div({
            "className": "home"},
            [logo, question_field, buttons_container]);


        // WALLS PAGE

        var wall_top = div({
            "className": "wall_top"},
            centralize(
                div({
                    "className": "wall_top_content"}, [
                    logo,
                    question_field,
                    ask_button])));

        var my_questions = st.questions.filter(function(question){
            return question.user_id === st.id;
        }.bind(this)).reverse();

        var wall_body = centralize(my_questions.map(question));

        var wall = div({
            "className": "wall"},
            [wall_top, wall_body]);



        // ANSWERING PAGE

        var answering_points = div({
            "className": "answering_points"},
            "("+this.state.points+" ponto"+(this.state.points===1?"":"s")+"!)");

        var answering_top = div({
            "className": "answering_top"},[
            logo,
            answering_points]);

        function rand(seed){
            return (seed * 1103515245 + 12345) & 0x7fffffff;
        };

        var question_to_answer = (function(){
            var question_to_answer = null;
            var question_to_answer_rnd = 0;
            var rnd = rand(st.id);
            for (var i=0, l=st.questions.length; i<l; ++i){
                var rnd = rand(rnd);
                if (rnd > question_to_answer_rnd
                    && st.questions[i]
                    && st.questions[i].answer === ""
                    && !st.dunnos[i])
                    question_to_answer = st.questions[i],
                    question_to_answer_rnd = rnd;
            };
            return question_to_answer;
        })();

        var answering_question = question_to_answer ? question(question_to_answer) : [];

        var answer = function(){
            var input = document.getElementById("answering_input")
            this.state.act({
                "type"        : "answer",
                "time"        : Date.now(),
                "user_id"     : st.id,
                "question_id" : question_to_answer.id,
                "answer"      : input.value})();
            input.value = "";
        }.bind(this);

        var dunno = function(){
            this.state.act({
                "type"        : "dunno",
                "user_id"     : st.id,
                "question_id" : question_to_answer.id})();
        }.bind(this)

        var answering_answer = div({
            "className": "answering_button",
            "onClick": answer},
            "Responder");

        var answering_dunno = div({
            "className": "answering_button",
            "onClick": dunno},
            "Dunno")

        var answering_menu = div({
            "className": "answer_menu"}, [
            div({}, input({
                "id": "answering_input",
                "className": "answering_input ",
                "onKeyDown": function(e){ if (e.which === 13) answer(); }})),
            div({}, [answering_answer, answering_dunno])]);

        var answering_body = div({
            className: "answering_body"},[
            answering_question,
            answering_menu]);

        //var answering_points = div({}, this.state.points+()" pontos!");

        var answering_done = div({
            className: "answering_done"}, [
            "Nada para responder! Esperando novas quest√µes."]);

        var answering = question_to_answer 
            ? div({}, [answering_top, centralize(answering_body)])
            : div({}, [answering_top, centralize(answering_done)]);

        return ( st.page === "home" ? home 
               : st.page === "wall" ? wall
               : answering);
    }
});

window.onload = function(){
    ReactDOM.render(
        React.createElement(Dunno, null),
        document.getElementById('test'));
};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy5udm0vdmVyc2lvbnMvbm9kZS92NS45LjEvbGliL25vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJpbmRleC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIi8vdmFyIFJlYWN0ID0gcmVxdWlyZShcInJlYWN0XCIpO1xuLy92YXIgUmVhY3RET00gPSByZXF1aXJlKFwicmVhY3QtZG9tXCIpO1xuZm9yICh2YXIga2V5IGluIFJlYWN0LkRPTSkgZ2xvYmFsW2tleV0gPSBSZWFjdC5ET01ba2V5XTtcblxudmFyIER1bm5vID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuXG4gICAgZ2V0SW5pdGlhbFN0YXRlOiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaWQgICAgICAgIDogMCxcbiAgICAgICAgICAgIHdzICAgICAgICA6IG51bGwsXG4gICAgICAgICAgICBwYWdlICAgICAgOiBcIndhbGxcIixcbiAgICAgICAgICAgIHF1ZXN0aW9uICA6IFwiXCIsXG4gICAgICAgICAgICBxdWVzdGlvbnMgOiBbXSxcbiAgICAgICAgICAgIGFuc3dlcmVkcyA6IFtdLCAvLyBpZHMgb2YgdGhlIHF1ZXN0aW9ucyBJIGRvbid0IGtub3dcbiAgICAgICAgICAgIGR1bm5vcyAgICA6IFtdLCAvLyBpZHMgb2YgdGhlIHF1ZXN0aW9ucyBJIGRvbid0IGtub3dcbiAgICAgICAgICAgIHBvaW50cyAgICA6IDBcbiAgICAgICAgfTtcbiAgICB9LFxuXG4gICAgY29tcG9uZW50RGlkTW91bnQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHZhciB3cyA9IG5ldyBXZWJTb2NrZXQoU0VSVkVSX1VSTCk7XG4gICAgICAgIHdzLm9ub3BlbiA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImNvbm5lY3RlZFwiKTtcbiAgICAgICAgfTtcbiAgICAgICAgd3Mub25tZXNzYWdlID0gZnVuY3Rpb24obXNnKXtcbiAgICAgICAgICAgIHZhciBhY3Rpb25zID0gSlNPTi5wYXJzZShcIltcIittc2cuZGF0YStcIl1cIik7XG4gICAgICAgICAgICBpZiAodGhpcy5zdGF0ZS5pZCA9PT0gMCl7XG4gICAgICAgICAgICAgICAgKyt0aGlzLnN0YXRlLmlkO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGk9MCwgbD1hY3Rpb25zLmxlbmd0aDsgaTxsOyArK2kpXG4gICAgICAgICAgICAgICAgICAgIGlmIChhY3Rpb25zW2ldLnR5cGUgPT09IFwiam9pblwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgKyt0aGlzLnN0YXRlLmlkO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGZvciAodmFyIGk9MCwgbD1hY3Rpb25zLmxlbmd0aDsgaTxsOyArK2kpe1xuICAgICAgICAgICAgICAgIHZhciBhY3Rpb24gPSBhY3Rpb25zW2ldO1xuICAgICAgICAgICAgICAgIHZhciBxdWVzdGlvbiA9IHRoaXMuc3RhdGUucXVlc3Rpb25zW2FjdGlvbi5xdWVzdGlvbl9pZF07XG4gICAgICAgICAgICAgICAgc3dpdGNoIChhY3Rpb24udHlwZSl7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJhc2tcIjpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0ZS5xdWVzdGlvbnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBcImlkXCIgICAgICAgICAgOiB0aGlzLnN0YXRlLnF1ZXN0aW9ucy5sZW5ndGgsXG4gICAgICAgICAgICAgICAgICAgICAgICBcInVzZXJfaWRcIiAgICAgOiBhY3Rpb24udXNlcl9pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidGV4dFwiICAgICAgICA6IGFjdGlvbi5xdWVzdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidGltZVwiICAgICAgICA6IGFjdGlvbi50aW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJhbnN3ZXJcIiAgICAgIDogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiYW5zd2VyX3RpbWVcIiA6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBcInBlcnNvbnNcIiAgICAgOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJzdGF0dXNcIiAgICAgIDogXCJyb3V0aW5nXCJ9KTsgLy8gcm91dGluZywgYWNjZXB0ZWQsIHJlZnVzZWRcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcImFuc3dlclwiOlxuICAgICAgICAgICAgICAgICAgICBxdWVzdGlvbi5hbnN3ZXIgPSBhY3Rpb24uYW5zd2VyO1xuICAgICAgICAgICAgICAgICAgICBxdWVzdGlvbi5hbnN3ZXJfdGltZSA9IGFjdGlvbi50aW1lO1xuICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aW9uLnVzZXJfaWQgPT09IHRoaXMuc3RhdGUuaWQpXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRlLmFuc3dlcmVkc1thY3Rpb24ucXVlc3Rpb25faWRdID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcImR1bm5vXCI6XG4gICAgICAgICAgICAgICAgICAgICsrcXVlc3Rpb24ucGVyc29ucztcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGlvbi51c2VyX2lkID09PSB0aGlzLnN0YXRlLmlkKVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0ZS5kdW5ub3NbYWN0aW9uLnF1ZXN0aW9uX2lkXSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJhY2NlcHRcIjpcbiAgICAgICAgICAgICAgICAgICAgaWYgKHF1ZXN0aW9uLmFuc3dlciAhPT0gXCJcIiBcbiAgICAgICAgICAgICAgICAgICAgICAgICYmIHF1ZXN0aW9uLnN0YXR1cyA9PT0gXCJyb3V0aW5nXCIgXG4gICAgICAgICAgICAgICAgICAgICAgICAmJiBhY3Rpb24udXNlcl9pZCA9PT0gcXVlc3Rpb24udXNlcl9pZCl7XG4gICAgICAgICAgICAgICAgICAgICAgICBxdWVzdGlvbi5zdGF0dXMgPSBcImFjY2VwdGVkXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0ZS5hbnN3ZXJlZHNbcXVlc3Rpb24uaWRdKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICsrdGhpcy5zdGF0ZS5wb2ludHM7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJyZWZ1c2VcIjpcbiAgICAgICAgICAgICAgICAgICAgaWYgKHF1ZXN0aW9uLmFuc3dlciAhPT0gXCJcIiBcbiAgICAgICAgICAgICAgICAgICAgICAgICYmIHF1ZXN0aW9uLnN0YXR1cyA9PT0gXCJyb3V0aW5nXCIgXG4gICAgICAgICAgICAgICAgICAgICAgICAmJiBhY3Rpb24udXNlcl9pZCA9PT0gcXVlc3Rpb24udXNlcl9pZCl7XG4gICAgICAgICAgICAgICAgICAgICAgICBxdWVzdGlvbi5zdGF0dXMgPSBcInJlZnVzZWRcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlLmFuc3dlcmVkc1txdWVzdGlvbi5pZF0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLS10aGlzLnN0YXRlLnBvaW50cztcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiQ2xpZW50IGlkIGlzOiBcIit0aGlzLnN0YXRlLmlkKVxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJRdWVzdGlvbnM6IFwiK0pTT04uc3RyaW5naWZ5KHRoaXMuc3RhdGUucXVlc3Rpb25zKSk7XG5cbiAgICAgICAgICAgIHRoaXMuc3RhdGUuYWN0ID0gZnVuY3Rpb24oYWN0aW9uKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgd3Muc2VuZChKU09OLnN0cmluZ2lmeShhY3Rpb24pKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdGhpcy5mb3JjZVVwZGF0ZSgpO1xuICAgICAgICB9LmJpbmQodGhpcyk7XG4gICAgICAgIHNldEludGVydmFsKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLmZvcmNlVXBkYXRlKCk7XG4gICAgICAgIH0uYmluZCh0aGlzKSwgNTAwKTtcbiAgICB9LFxuXG4gICAgcmVuZGVyOiBmdW5jdGlvbigpIHtcblxuICAgICAgICBmdW5jdGlvbiBjZW50cmFsaXplKGJvZHkpe1xuICAgICAgICAgICAgcmV0dXJuIGRpdih7XCJjbGFzc05hbWVcIjogXCJjZW50cmFsaXplcl9vdXRlclwifSxcbiAgICAgICAgICAgICAgICBkaXYoe1wiY2xhc3NOYW1lXCI6IFwiY2VudHJhbGl6ZXJfaW5uZXJcIn0sXG4gICAgICAgICAgICAgICAgYm9keSkpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBxdWVzdGlvbiA9IGZ1bmN0aW9uKHF1ZXN0aW9uKXtcblxuICAgICAgICAgICAgdmFyIHF1ZXN0aW9uX3RpdGxlID0gZGl2KHtcbiAgICAgICAgICAgICAgICBcImNsYXNzTmFtZVwiOiBcInF1ZXN0aW9uX3RpdGxlXCJ9LCBbXG4gICAgICAgICAgICAgICAgcXVlc3Rpb24udGV4dF0pO1xuXG4gICAgICAgICAgICB2YXIgcXVlc3Rpb25fc2Vjb25kcyA9IGRpdih7XG4gICAgICAgICAgICAgICAgXCJjbGFzc05hbWVcIjogXCJxdWVzdGlvbl9zZWNvbmRzXCJ9LFxuICAgICAgICAgICAgICAgIE1hdGguZmxvb3IoKChxdWVzdGlvbi5hbnN3ZXJfdGltZXx8RGF0ZS5ub3coKSktcXVlc3Rpb24udGltZSkvMTAwMCkrJ1wiJyk7XG5cbiAgICAgICAgICAgIHZhciBxdWVzdGlvbl9wZXJzb25zID0gZGl2KHtcbiAgICAgICAgICAgICAgICBcImNsYXNzTmFtZVwiOiBcInF1ZXN0aW9uX3BlcnNvbnNcIn0sXG4gICAgICAgICAgICAgICAgcXVlc3Rpb24ucGVyc29ucytcIuybg1wiKTsgLy8g8J+RpFxuXG4gICAgICAgICAgICB2YXIgcXVlc3Rpb25faGVhZF9ib3ggPSBkaXYoe1xuICAgICAgICAgICAgICAgIFwiY2xhc3NOYW1lXCI6IFwicXVlc3Rpb25faGVhZF9ib3hcIn0sW1xuICAgICAgICAgICAgICAgIHF1ZXN0aW9uX3NlY29uZHMsXG4gICAgICAgICAgICAgICAgcXVlc3Rpb25fcGVyc29uc10pO1xuXG4gICAgICAgICAgICB2YXIgcXVlc3Rpb25fYWNjZXB0ZWQgPSBkaXYoe1xuICAgICAgICAgICAgICAgIFwib25DbGlja1wiOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRlLmFjdCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBcInR5cGVcIjpcImFjY2VwdFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ1c2VyX2lkXCI6IHRoaXMuc3RhdGUuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBcInF1ZXN0aW9uX2lkXCI6cXVlc3Rpb24uaWR9KSgpO1xuICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSxcbiAgICAgICAgICAgICAgICBcImNsYXNzTmFtZVwiOlwicXVlc3Rpb25fYWNjZXB0aW9uIFwiKyhxdWVzdGlvbi5zdGF0dXM9PT1cImFjY2VwdGVkXCI/XCJhY2NlcHRlZFwiOlwiXCIpfSxcbiAgICAgICAgICAgICAgICBcIuKck1wiKTtcblxuICAgICAgICAgICAgdmFyIHF1ZXN0aW9uX3JlZnVzZWQgPSBkaXYoe1xuICAgICAgICAgICAgICAgIFwib25DbGlja1wiOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRlLmFjdCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBcInR5cGVcIjpcInJlZnVzZVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ1c2VyX2lkXCI6IHRoaXMuc3RhdGUuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBcInF1ZXN0aW9uX2lkXCI6cXVlc3Rpb24uaWR9KSgpO1xuICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSxcbiAgICAgICAgICAgICAgICBcImNsYXNzTmFtZVwiOlwicXVlc3Rpb25fYWNjZXB0aW9uIFwiKyhxdWVzdGlvbi5zdGF0dXM9PT1cInJlZnVzZWRcIj9cInJlZnVzZWRcIjpcIlwiKX0sXG4gICAgICAgICAgICAgICAgXCLinJdcIik7XG5cbiAgICAgICAgICAgIHZhciBxdWVzdGlvbl9hY2NlcHRpb25fYm94ID0gZGl2KHtcbiAgICAgICAgICAgICAgICBcImNsYXNzTmFtZVwiOiBcInF1ZXN0aW9uX2FjY2VwdGlvbl9ib3hcIn0sW1xuICAgICAgICAgICAgICAgIHF1ZXN0aW9uX2FjY2VwdGVkLFxuICAgICAgICAgICAgICAgIHF1ZXN0aW9uX3JlZnVzZWRdKTtcblxuXG4gICAgICAgICAgICB2YXIgcXVlc3Rpb25faGVhZCA9IGRpdih7XG4gICAgICAgICAgICAgICAgXCJjbGFzc05hbWVcIjogXCJxdWVzdGlvbl9oZWFkXCJ9LFtcbiAgICAgICAgICAgICAgICBxdWVzdGlvbl9oZWFkX2JveCxcbiAgICAgICAgICAgICAgICBxdWVzdGlvbl9hY2NlcHRpb25fYm94XSk7XG5cbiAgICAgICAgICAgIHZhciBxdWVzdGlvbl9hbnN3ZXIgPSBkaXYoe1xuICAgICAgICAgICAgICAgIFwiY2xhc3NOYW1lXCI6IFwicXVlc3Rpb25fYW5zd2VyXCJ9LFtcbiAgICAgICAgICAgICAgICBxdWVzdGlvbi5hbnN3ZXIgIT09IFwiXCJcbiAgICAgICAgICAgICAgICAgICAgPyBxdWVzdGlvbi5hbnN3ZXJcbiAgICAgICAgICAgICAgICAgICAgOiBcIkVzcGVyYW5kbyByZXNwb3N0YS4uLlwiXSk7XG5cbiAgICAgICAgICAgIHZhciBxdWVzdGlvbl9ib2R5ID0gZGl2KHtcbiAgICAgICAgICAgICAgICBcImNsYXNzTmFtZVwiOiBcInF1ZXN0aW9uX2JvZHlcIn0sW1xuICAgICAgICAgICAgICAgIHF1ZXN0aW9uX3RpdGxlLFxuICAgICAgICAgICAgICAgIHF1ZXN0aW9uX2Fuc3dlcl0pO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgdmFyIHF1ZXN0aW9uX2xhbXAgPSBkaXYoe1xuICAgICAgICAgICAgICAgIFwiY2xhc3NOYW1lXCI6IFwicXVlc3Rpb25fbGFtcFwifSxcbiAgICAgICAgICAgICAgICAvL1wiWFwiKTtcbiAgICAgICAgICAgICAgICBpbWcoe1wic3JjXCI6IChxdWVzdGlvbi5zdGF0dXM9PT1cInJvdXRpbmdcIiA/IChxdWVzdGlvbi5hbnN3ZXI9PT1cIlwiID8gXCJpbWcvbGFtcGFkYV9hcGFnYWRhLnBuZ1wiIDogXCJpbWcvbGFtcGFkYV9hY2VzYS5naWZcIikgOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIChxdWVzdGlvbi5zdGF0dXM9PT1cImFjY2VwdGVkXCIgPyBcImltZy9sYW1wYWRhX2FjZXNhLnBuZ1wiIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImltZy9sYW1wYWRhX2FwYWdhZGEucG5nXCIpKSxcbiAgICAgICAgICAgICAgICAgICAgXCJhbHRcIjogXCJsYW1wYWRhXCIsXG4gICAgICAgICAgICAgICAgICAgIFwid2lkdGhcIjpcIjEwMFwiLFxuICAgICAgICAgICAgICAgICAgICBcImhlaWdodFwiOlwiMTAwXCJcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4gZGl2KHtcbiAgICAgICAgICAgICAgICBcImNsYXNzTmFtZVwiOiBcInF1ZXN0aW9uXCJ9LFtcbiAgICAgICAgICAgICAgICBxdWVzdGlvbl9oZWFkLFxuICAgICAgICAgICAgICAgIHF1ZXN0aW9uX2JvZHksXG4gICAgICAgICAgICAgICAgcXVlc3Rpb25fbGFtcFxuICAgICAgICAgICAgICAgIF0pO1xuICAgICAgICB9LmJpbmQodGhpcyk7XG5cbiAgICAgICAgdmFyIHN0ID0gdGhpcy5zdGF0ZTtcblxuXG5cbiAgICAgICAgLy8gSE9NRSBQQUdFXG5cbiAgICAgICAgdmFyIGxvZ28gPSBkaXYoe1xuICAgICAgICAgICAgXCJvbkNsaWNrXCI6IGZ1bmN0aW9uKCl7IHN0LnBhZ2UgPSBcImhvbWVcIjsgfS5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgXCJjbGFzc05hbWVcIjogc3QucGFnZSA9PT0gXCJob21lXCIgPyBcImxvZ29cIiA6IFwibG9nb19zbWFsbFwifSxcbiAgICAgICAgICAgIFwiZHVubm9cIik7XG5cbiAgICAgICAgdmFyIHF1ZXN0aW9uX2ZpZWxkID0gZGl2KHtcImNsYXNzTmFtZVwiOiBcInF1ZXN0aW9uX2ZpZWxkX2JveFwifSwgaW5wdXQoe1xuICAgICAgICAgICAgXCJpZFwiOiBcInF1ZXN0aW9uX2ZpZWxkXCIsXG4gICAgICAgICAgICBcImtleVwiOiBcInF1ZXN0aW9uX2ZpZWxkXCIsXG4gICAgICAgICAgICBcImNsYXNzTmFtZVwiOiBcInF1ZXN0aW9uX2ZpZWxkXCIsXG4gICAgICAgICAgICBcInBsYWNlaG9sZGVyXCI6IFwiPGluc2VyaXIgc2xvZ2FuIGFxdWk+XCIsXG4gICAgICAgICAgICBcIm9uS2V5UHJlc3NcIjogZnVuY3Rpb24oZSl7IGlmIChlLndoaWNoID09PSAxMykgYXNrKCk7IH0sXG4gICAgICAgICAgICBcIm9uQ2hhbmdlXCI6IGZ1bmN0aW9uKGUpe1xuICAgICAgICAgICAgICAgIHN0LnF1ZXN0aW9uID0gZS50YXJnZXQudmFsdWU7XG4gICAgICAgICAgICAgICAgdGhpcy5mb3JjZVVwZGF0ZSgpO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgXCJ0eXBlXCI6IFwidGV4dFwifSkpO1xuXG4gICAgICAgIHZhciBhc2sgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgaWYgKHN0LnF1ZXN0aW9uLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xuICAgICAgICAgICAgdGhpcy5zdGF0ZS5hY3Qoe1xuICAgICAgICAgICAgICAgIFwidHlwZVwiICAgICA6IFwiYXNrXCIsXG4gICAgICAgICAgICAgICAgXCJxdWVzdGlvblwiIDogc3QucXVlc3Rpb24sXG4gICAgICAgICAgICAgICAgXCJ0aW1lXCIgICAgIDogRGF0ZS5ub3coKSxcbiAgICAgICAgICAgICAgICBcInVzZXJfaWRcIiAgOiBzdC5pZH0pKCk7XG4gICAgICAgICAgICBzdC5xdWVzdGlvbiA9IFwiXCI7XG4gICAgICAgICAgICBzdC5wYWdlID0gXCJ3YWxsXCI7XG4gICAgICAgICAgICB0aGlzLmZvcmNlVXBkYXRlKCk7XG4gICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInF1ZXN0aW9uX2ZpZWxkXCIpLnZhbHVlID0gXCJcIjtcbiAgICAgICAgfS5iaW5kKHRoaXMpO1xuXG4gICAgICAgIHZhciBhc2tfYnV0dG9uID0gZGl2KHtcbiAgICAgICAgICAgIFwiaWRcIjogXCJhc2tfYnV0dG9uXCIsXG4gICAgICAgICAgICBcImtleVwiOiBcImFza19idXR0b25cIixcbiAgICAgICAgICAgIFwib25DbGlja1wiOiBhc2ssXG4gICAgICAgICAgICBcImNsYXNzTmFtZVwiOiBcImJ1dHRvbiBhc2tfYnV0dG9uXCJ9LFxuICAgICAgICAgICAgW1wiRmF6ZXIgcGVyZ3VudGFcIl0pO1xuXG4gICAgICAgIHZhciBxdWlja19idXR0b24gPSBkaXYoe1xuICAgICAgICAgICAgXCJpZFwiOiBcInF1aWNrX2J1dHRvblwiLFxuICAgICAgICAgICAgXCJrZXlcIjogXCJxdWlja19idXR0b25cIixcbiAgICAgICAgICAgIFwib25DbGlja1wiOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHN0LnBhZ2UgPSBcImFuc3dlcmluZ1wiO1xuICAgICAgICAgICAgICAgIHRoaXMuZm9yY2VVcGRhdGUoKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSxcbiAgICAgICAgICAgIFwiY2xhc3NOYW1lXCI6IFwiYnV0dG9uIHF1aWNrX2J1dHRvblwifSxcbiAgICAgICAgICAgIFtcIlByZWZpcm8gcmVzcG9uZGVyXCJdKTtcblxuICAgICAgICB2YXIgYnV0dG9uc19jb250YWluZXIgPSBkaXYoe1xuICAgICAgICAgICAgXCJrZXlcIjogXCJidXR0b25zX2NvbnRhaW5lclwiLFxuICAgICAgICAgICAgXCJjbGFzc05hbWVcIjogXCJidXR0b25fY29udGFpbmVyXCJ9LFxuICAgICAgICAgICAgW2Fza19idXR0b24sIHF1aWNrX2J1dHRvbl0pO1xuXG4gICAgICAgIHZhciBob21lID0gZGl2KHtcbiAgICAgICAgICAgIFwiY2xhc3NOYW1lXCI6IFwiaG9tZVwifSxcbiAgICAgICAgICAgIFtsb2dvLCBxdWVzdGlvbl9maWVsZCwgYnV0dG9uc19jb250YWluZXJdKTtcblxuXG4gICAgICAgIC8vIFdBTExTIFBBR0VcblxuICAgICAgICB2YXIgd2FsbF90b3AgPSBkaXYoe1xuICAgICAgICAgICAgXCJjbGFzc05hbWVcIjogXCJ3YWxsX3RvcFwifSxcbiAgICAgICAgICAgIGNlbnRyYWxpemUoXG4gICAgICAgICAgICAgICAgZGl2KHtcbiAgICAgICAgICAgICAgICAgICAgXCJjbGFzc05hbWVcIjogXCJ3YWxsX3RvcF9jb250ZW50XCJ9LCBbXG4gICAgICAgICAgICAgICAgICAgIGxvZ28sXG4gICAgICAgICAgICAgICAgICAgIHF1ZXN0aW9uX2ZpZWxkLFxuICAgICAgICAgICAgICAgICAgICBhc2tfYnV0dG9uXSkpKTtcblxuICAgICAgICB2YXIgbXlfcXVlc3Rpb25zID0gc3QucXVlc3Rpb25zLmZpbHRlcihmdW5jdGlvbihxdWVzdGlvbil7XG4gICAgICAgICAgICByZXR1cm4gcXVlc3Rpb24udXNlcl9pZCA9PT0gc3QuaWQ7XG4gICAgICAgIH0uYmluZCh0aGlzKSkucmV2ZXJzZSgpO1xuXG4gICAgICAgIHZhciB3YWxsX2JvZHkgPSBjZW50cmFsaXplKG15X3F1ZXN0aW9ucy5tYXAocXVlc3Rpb24pKTtcblxuICAgICAgICB2YXIgd2FsbCA9IGRpdih7XG4gICAgICAgICAgICBcImNsYXNzTmFtZVwiOiBcIndhbGxcIn0sXG4gICAgICAgICAgICBbd2FsbF90b3AsIHdhbGxfYm9keV0pO1xuXG5cblxuICAgICAgICAvLyBBTlNXRVJJTkcgUEFHRVxuXG4gICAgICAgIHZhciBhbnN3ZXJpbmdfcG9pbnRzID0gZGl2KHtcbiAgICAgICAgICAgIFwiY2xhc3NOYW1lXCI6IFwiYW5zd2VyaW5nX3BvaW50c1wifSxcbiAgICAgICAgICAgIFwiKFwiK3RoaXMuc3RhdGUucG9pbnRzK1wiIHBvbnRvXCIrKHRoaXMuc3RhdGUucG9pbnRzPT09MT9cIlwiOlwic1wiKStcIiEpXCIpO1xuXG4gICAgICAgIHZhciBhbnN3ZXJpbmdfdG9wID0gZGl2KHtcbiAgICAgICAgICAgIFwiY2xhc3NOYW1lXCI6IFwiYW5zd2VyaW5nX3RvcFwifSxbXG4gICAgICAgICAgICBsb2dvLFxuICAgICAgICAgICAgYW5zd2VyaW5nX3BvaW50c10pO1xuXG4gICAgICAgIGZ1bmN0aW9uIHJhbmQoc2VlZCl7XG4gICAgICAgICAgICByZXR1cm4gKHNlZWQgKiAxMTAzNTE1MjQ1ICsgMTIzNDUpICYgMHg3ZmZmZmZmZjtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgcXVlc3Rpb25fdG9fYW5zd2VyID0gKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB2YXIgcXVlc3Rpb25fdG9fYW5zd2VyID0gbnVsbDtcbiAgICAgICAgICAgIHZhciBxdWVzdGlvbl90b19hbnN3ZXJfcm5kID0gMDtcbiAgICAgICAgICAgIHZhciBybmQgPSByYW5kKHN0LmlkKTtcbiAgICAgICAgICAgIGZvciAodmFyIGk9MCwgbD1zdC5xdWVzdGlvbnMubGVuZ3RoOyBpPGw7ICsraSl7XG4gICAgICAgICAgICAgICAgdmFyIHJuZCA9IHJhbmQocm5kKTtcbiAgICAgICAgICAgICAgICBpZiAocm5kID4gcXVlc3Rpb25fdG9fYW5zd2VyX3JuZFxuICAgICAgICAgICAgICAgICAgICAmJiBzdC5xdWVzdGlvbnNbaV1cbiAgICAgICAgICAgICAgICAgICAgJiYgc3QucXVlc3Rpb25zW2ldLmFuc3dlciA9PT0gXCJcIlxuICAgICAgICAgICAgICAgICAgICAmJiAhc3QuZHVubm9zW2ldKVxuICAgICAgICAgICAgICAgICAgICBxdWVzdGlvbl90b19hbnN3ZXIgPSBzdC5xdWVzdGlvbnNbaV0sXG4gICAgICAgICAgICAgICAgICAgIHF1ZXN0aW9uX3RvX2Fuc3dlcl9ybmQgPSBybmQ7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHF1ZXN0aW9uX3RvX2Fuc3dlcjtcbiAgICAgICAgfSkoKTtcblxuICAgICAgICB2YXIgYW5zd2VyaW5nX3F1ZXN0aW9uID0gcXVlc3Rpb25fdG9fYW5zd2VyID8gcXVlc3Rpb24ocXVlc3Rpb25fdG9fYW5zd2VyKSA6IFtdO1xuXG4gICAgICAgIHZhciBhbnN3ZXIgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyIGlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJhbnN3ZXJpbmdfaW5wdXRcIilcbiAgICAgICAgICAgIHRoaXMuc3RhdGUuYWN0KHtcbiAgICAgICAgICAgICAgICBcInR5cGVcIiAgICAgICAgOiBcImFuc3dlclwiLFxuICAgICAgICAgICAgICAgIFwidGltZVwiICAgICAgICA6IERhdGUubm93KCksXG4gICAgICAgICAgICAgICAgXCJ1c2VyX2lkXCIgICAgIDogc3QuaWQsXG4gICAgICAgICAgICAgICAgXCJxdWVzdGlvbl9pZFwiIDogcXVlc3Rpb25fdG9fYW5zd2VyLmlkLFxuICAgICAgICAgICAgICAgIFwiYW5zd2VyXCIgICAgICA6IGlucHV0LnZhbHVlfSkoKTtcbiAgICAgICAgICAgIGlucHV0LnZhbHVlID0gXCJcIjtcbiAgICAgICAgfS5iaW5kKHRoaXMpO1xuXG4gICAgICAgIHZhciBkdW5ubyA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLnN0YXRlLmFjdCh7XG4gICAgICAgICAgICAgICAgXCJ0eXBlXCIgICAgICAgIDogXCJkdW5ub1wiLFxuICAgICAgICAgICAgICAgIFwidXNlcl9pZFwiICAgICA6IHN0LmlkLFxuICAgICAgICAgICAgICAgIFwicXVlc3Rpb25faWRcIiA6IHF1ZXN0aW9uX3RvX2Fuc3dlci5pZH0pKCk7XG4gICAgICAgIH0uYmluZCh0aGlzKVxuXG4gICAgICAgIHZhciBhbnN3ZXJpbmdfYW5zd2VyID0gZGl2KHtcbiAgICAgICAgICAgIFwiY2xhc3NOYW1lXCI6IFwiYW5zd2VyaW5nX2J1dHRvblwiLFxuICAgICAgICAgICAgXCJvbkNsaWNrXCI6IGFuc3dlcn0sXG4gICAgICAgICAgICBcIlJlc3BvbmRlclwiKTtcblxuICAgICAgICB2YXIgYW5zd2VyaW5nX2R1bm5vID0gZGl2KHtcbiAgICAgICAgICAgIFwiY2xhc3NOYW1lXCI6IFwiYW5zd2VyaW5nX2J1dHRvblwiLFxuICAgICAgICAgICAgXCJvbkNsaWNrXCI6IGR1bm5vfSxcbiAgICAgICAgICAgIFwiRHVubm9cIilcblxuICAgICAgICB2YXIgYW5zd2VyaW5nX21lbnUgPSBkaXYoe1xuICAgICAgICAgICAgXCJjbGFzc05hbWVcIjogXCJhbnN3ZXJfbWVudVwifSwgW1xuICAgICAgICAgICAgZGl2KHt9LCBpbnB1dCh7XG4gICAgICAgICAgICAgICAgXCJpZFwiOiBcImFuc3dlcmluZ19pbnB1dFwiLFxuICAgICAgICAgICAgICAgIFwiY2xhc3NOYW1lXCI6IFwiYW5zd2VyaW5nX2lucHV0IFwiLFxuICAgICAgICAgICAgICAgIFwib25LZXlEb3duXCI6IGZ1bmN0aW9uKGUpeyBpZiAoZS53aGljaCA9PT0gMTMpIGFuc3dlcigpOyB9fSkpLFxuICAgICAgICAgICAgZGl2KHt9LCBbYW5zd2VyaW5nX2Fuc3dlciwgYW5zd2VyaW5nX2R1bm5vXSldKTtcblxuICAgICAgICB2YXIgYW5zd2VyaW5nX2JvZHkgPSBkaXYoe1xuICAgICAgICAgICAgY2xhc3NOYW1lOiBcImFuc3dlcmluZ19ib2R5XCJ9LFtcbiAgICAgICAgICAgIGFuc3dlcmluZ19xdWVzdGlvbixcbiAgICAgICAgICAgIGFuc3dlcmluZ19tZW51XSk7XG5cbiAgICAgICAgLy92YXIgYW5zd2VyaW5nX3BvaW50cyA9IGRpdih7fSwgdGhpcy5zdGF0ZS5wb2ludHMrKClcIiBwb250b3MhXCIpO1xuXG4gICAgICAgIHZhciBhbnN3ZXJpbmdfZG9uZSA9IGRpdih7XG4gICAgICAgICAgICBjbGFzc05hbWU6IFwiYW5zd2VyaW5nX2RvbmVcIn0sIFtcbiAgICAgICAgICAgIFwiTmFkYSBwYXJhIHJlc3BvbmRlciEgRXNwZXJhbmRvIG5vdmFzIHF1ZXN0w7Vlcy5cIl0pO1xuXG4gICAgICAgIHZhciBhbnN3ZXJpbmcgPSBxdWVzdGlvbl90b19hbnN3ZXIgXG4gICAgICAgICAgICA/IGRpdih7fSwgW2Fuc3dlcmluZ190b3AsIGNlbnRyYWxpemUoYW5zd2VyaW5nX2JvZHkpXSlcbiAgICAgICAgICAgIDogZGl2KHt9LCBbYW5zd2VyaW5nX3RvcCwgY2VudHJhbGl6ZShhbnN3ZXJpbmdfZG9uZSldKTtcblxuICAgICAgICByZXR1cm4gKCBzdC5wYWdlID09PSBcImhvbWVcIiA/IGhvbWUgXG4gICAgICAgICAgICAgICA6IHN0LnBhZ2UgPT09IFwid2FsbFwiID8gd2FsbFxuICAgICAgICAgICAgICAgOiBhbnN3ZXJpbmcpO1xuICAgIH1cbn0pO1xuXG53aW5kb3cub25sb2FkID0gZnVuY3Rpb24oKXtcbiAgICBSZWFjdERPTS5yZW5kZXIoXG4gICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoRHVubm8sIG51bGwpLFxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGVzdCcpKTtcbn07XG4iXX0=
